# Quality Gates

> Generated by: QA Manager (Phase 0 Governance Setup)
> Date: {{GENERATED_DATE}}
> Version: 1.0.0

---

## 1. Test Coverage Requirements

### 1.1 Coverage Thresholds

| Type | Minimum | Target | Enforcement |
|------|---------|--------|-------------|
| Unit Tests | 80% | 90% | CI Block |
| Integration Tests | 70% | 85% | CI Warn |
| E2E Tests (Critical Paths) | 100% | 100% | CI Block |

### 1.2 Coverage by Module

| Module | Unit | Integration | E2E | Notes |
|--------|------|-------------|-----|-------|
| Authentication | 90% | 90% | 100% | Security critical |
| Payment | 95% | 95% | 100% | Financial critical |
| User Management | 80% | 80% | 80% | Standard |
| {{MODULE}} | {{%}} | {{%}} | {{%}} | {{NOTES}} |

### 1.3 Coverage Exclusions
```
# Files excluded from coverage calculation:
- **/*.test.ts
- **/*.spec.ts
- **/mocks/**
- **/types/**
- **/index.ts (barrel files)
```

---

## 2. Code Quality Standards

### 2.1 Static Analysis

| Check | Tool | Threshold | Enforcement |
|-------|------|-----------|-------------|
| Lint Errors | ESLint | 0 | CI Block |
| TypeScript Errors | tsc --strict | 0 | CI Block |
| Cyclomatic Complexity | ESLint | ≤ 10 per function | CI Warn |
| Code Duplication | jscpd | ≤ 5% | CI Warn |

### 2.2 Code Review Checklist

#### Functionality
- [ ] Meets acceptance criteria from task
- [ ] Edge cases are handled
- [ ] Error handling is appropriate

#### Code Quality
- [ ] Follows naming conventions (ADR-004)
- [ ] No hardcoded values (use constants/config)
- [ ] No commented-out code
- [ ] Functions are focused (single responsibility)

#### Testing
- [ ] Unit tests for new logic
- [ ] Integration tests for API changes
- [ ] Tests are meaningful (not just coverage)

#### Documentation
- [ ] Complex logic has comments
- [ ] Public APIs have JSDoc/docstrings
- [ ] README updated if applicable

#### Security
- [ ] No secrets in code
- [ ] Input validation present
- [ ] SQL injection / XSS prevention

---

## 3. Performance Requirements

### 3.1 API Performance

| Metric | Threshold | Measurement |
|--------|-----------|-------------|
| Response Time (P50) | ≤ 100ms | Prometheus/DataDog |
| Response Time (P95) | ≤ 200ms | Prometheus/DataDog |
| Response Time (P99) | ≤ 500ms | Prometheus/DataDog |
| Error Rate | ≤ 0.1% | Error tracking |
| Timeout | 30s max | Load balancer |

### 3.2 Frontend Performance

| Metric | Threshold | Tool |
|--------|-----------|------|
| First Contentful Paint (FCP) | ≤ 1.8s | Lighthouse |
| Largest Contentful Paint (LCP) | ≤ 2.5s | Lighthouse |
| First Input Delay (FID) | ≤ 100ms | Lighthouse |
| Cumulative Layout Shift (CLS) | ≤ 0.1 | Lighthouse |
| Time to Interactive (TTI) | ≤ 3.8s | Lighthouse |
| Bundle Size (JS) | ≤ 200KB gzipped | Webpack analyzer |

### 3.3 Load Testing

| Scenario | Concurrent Users | Duration | Pass Criteria |
|----------|-----------------|----------|---------------|
| Normal Load | 100 | 10 min | P95 < 200ms |
| Peak Load | 500 | 5 min | P95 < 500ms |
| Stress Test | 1000 | 2 min | No crashes |

---

## 4. Security Requirements

### 4.1 OWASP Top 10 Compliance

| Vulnerability | Prevention | Validation |
|---------------|------------|------------|
| A01 Broken Access Control | RBAC, ownership checks | Automated tests |
| A02 Cryptographic Failures | TLS 1.3, AES-256 | Security scan |
| A03 Injection | Parameterized queries, input validation | SAST |
| A04 Insecure Design | Threat modeling | Architecture review |
| A05 Security Misconfiguration | Hardened defaults | Infrastructure scan |
| A06 Vulnerable Components | Dependency audit | npm audit / Snyk |
| A07 Auth Failures | MFA, session management | Penetration test |
| A08 Data Integrity Failures | Signed packages, checksums | CI verification |
| A09 Logging Failures | Centralized logging, alerts | Log audit |
| A10 SSRF | URL allowlisting | Input validation |

### 4.2 Dependency Audit

| Severity | Action | Timeline |
|----------|--------|----------|
| Critical | Block deployment | Immediate |
| High | Block deployment | Within 24h |
| Medium | Warn | Within 1 week |
| Low | Backlog | Next sprint |

### 4.3 Secrets Management

- [ ] No hardcoded secrets in code
- [ ] `.env` files in `.gitignore`
- [ ] Secrets stored in vault (AWS Secrets Manager, HashiCorp Vault)
- [ ] Secrets rotated on schedule

---

## 5. Release Approval Checklist

### 5.1 Pre-Release Gates

#### Code Quality Gate
- [ ] All lint/type checks pass
- [ ] Coverage thresholds met
- [ ] No critical/high SonarQube issues

#### Testing Gate
- [ ] All unit tests pass
- [ ] All integration tests pass
- [ ] E2E critical paths pass
- [ ] Performance benchmarks met

#### Security Gate
- [ ] SAST scan clean
- [ ] Dependency audit clean
- [ ] No exposed secrets detected

#### Documentation Gate
- [ ] API documentation updated
- [ ] Changelog entry added
- [ ] Breaking changes documented

### 5.2 Staging Validation

- [ ] Deployment successful to staging
- [ ] Smoke tests pass
- [ ] Manual QA sign-off
- [ ] No critical bugs in staging

### 5.3 Release Approval

| Role | Approval | Date |
|------|----------|------|
| QA Manager | [ ] Approved | |
| Tech Lead | [ ] Approved | |
| Product Owner | [ ] Approved | |

---

## 6. Rollback Criteria

### 6.1 Automatic Rollback Triggers

| Condition | Threshold | Action |
|-----------|-----------|--------|
| Error Rate Spike | > 5% for 5 min | Auto rollback |
| Latency Spike | P95 > 1s for 5 min | Auto rollback |
| Health Check Failure | 3 consecutive | Auto rollback |

### 6.2 Manual Rollback Triggers

- Critical bug affecting core functionality
- Security vulnerability discovered
- Data corruption detected

---

## 7. Metrics & Reporting

### 7.1 Quality Dashboard

| Metric | Source | Update Frequency |
|--------|--------|------------------|
| Test Coverage | CI/CD | Per commit |
| Code Quality Score | SonarQube | Daily |
| Open Bug Count | Issue Tracker | Real-time |
| Security Vulnerabilities | Snyk/Dependabot | Daily |

### 7.2 Quality Reports

| Report | Frequency | Audience |
|--------|-----------|----------|
| Sprint Quality Summary | End of Sprint | Team + PM |
| Release Quality Report | Per Release | All Stakeholders |
| Security Audit Report | Monthly | Security + Leadership |

---

## Change Log

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| {{DATE}} | 1.0.0 | QA Manager | Initial quality gates |
